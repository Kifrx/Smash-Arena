<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login & Register - Smash Arena</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
      :root {
        --primary-green: #198754;
      }
      body {
        background-color: #f8f9fa;
        font-family: "Segoe UI", sans-serif;
      }
      .navbar-brand {
        font-weight: bold;
        color: var(--primary-green) !important;
        font-size: 1.5rem;
      }
      .nav-link {
        color: #555;
        font-weight: 500;
      }
      .nav-link:hover {
        color: var(--primary-green);
      }
      .login-container {
        min-height: 80vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .nav-pills .nav-link.active {
        background-color: var(--primary-green) !important;
      }
      .nav-pills .nav-link {
        color: var(--primary-green);
      }
      .btn-success {
        background-color: var(--primary-green);
        border-color: var(--primary-green);
      }
      .btn-outline-success {
        color: var(--primary-green);
        border-color: var(--primary-green);
      }
      .btn-outline-success:hover {
        background-color: var(--primary-green);
        color: white;
      }
    </style>
  </head>
  <body>
    <nav
      class="navbar navbar-expand-lg navbar-light bg-white sticky-top shadow-sm"
    >
      <div class="container">
        <a class="navbar-brand" href="index.html">üè∏ Smash Arena</a>
        <div
          class="collapse navbar-collapse justify-content-end"
          id="navbarNav"
        >
          <ul class="navbar-nav align-items-center gap-2">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item ms-lg-3">
              <a
                class="btn btn-outline-success rounded-pill btn-sm px-3"
                href="login.html"
                >Login</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container login-container">
      <div
        class="card shadow p-4"
        style="width: 400px; border-radius: 15px; border: none"
      >
        <div class="text-center mb-4">
          <h2 class="fw-bold" style="color: var(--primary-green)">Welcome!</h2>
          <p class="text-muted">Join us and start playing.</p>
        </div>

        <ul class="nav nav-pills nav-fill mb-4" id="pills-tab" role="tablist">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active fw-bold"
              id="login-tab"
              data-bs-toggle="pill"
              data-bs-target="#login-form"
              type="button"
            >
              Login
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link fw-bold"
              id="register-tab"
              data-bs-toggle="pill"
              data-bs-target="#register-form"
              type="button"
            >
              Register
            </button>
          </li>
        </ul>

        <div class="tab-content">
          <div class="tab-pane fade show active" id="login-form">
            <form onsubmit="handleLogin(event)">
              <div class="mb-3">
                <label class="form-label">Email Address</label>
                <input
                  type="email"
                  id="loginEmail"
                  class="form-control"
                  placeholder="Enter email"
                  required
                />
              </div>
              <div class="mb-4">
                <label class="form-label">Password</label>
                <input
                  type="password"
                  id="loginPassword"
                  class="form-control"
                  placeholder="Enter password"
                  required
                />
              </div>
              <button type="submit" class="btn btn-success w-100 py-2 fw-bold">
                Login
              </button>
            </form>
          </div>

          <div class="tab-pane fade" id="register-form">
            <form onsubmit="handleRegister(event)">
              <div class="mb-2">
                <label class="form-label">Full Name</label>
                <input
                  type="text"
                  id="regName"
                  class="form-control"
                  placeholder="Your full name"
                  required
                />
              </div>
              <div class="mb-2">
                <label class="form-label">Phone Number</label>
                <input
                  type="tel"
                  id="regPhone"
                  class="form-control"
                  placeholder="08xxxxxxxx"
                  required
                />
              </div>
              <div class="mb-2">
                <label class="form-label">Email</label>
                <input
                  type="email"
                  id="regEmail"
                  class="form-control"
                  placeholder="name@email.com"
                  required
                />
              </div>
              <div class="mb-4">
                <label class="form-label">Password</label>
                <input
                  type="password"
                  id="regPassword"
                  class="form-control"
                  placeholder="Create password"
                  required
                />
              </div>
              <button
                type="submit"
                class="btn btn-outline-success w-100 py-2 fw-bold"
              >
                Create Account
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      const API_URL = "/api/Users";

      // 1. LOGIN
      async function handleLogin(event) {
        event.preventDefault();

        const loginData = {
          email: document.getElementById("loginEmail").value,
          password: document.getElementById("loginPassword").value,
        };

        try {
          const response = await fetch(`${API_URL}/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(loginData),
          });

          const result = await response.json();

          if (response.ok) {
            localStorage.setItem("user_data", JSON.stringify(result));

            let role = result.role || result.Role;
            let name = result.namaLengkap || result.nama_Lengkap || "User";

            Swal.fire({
              icon: "success",
              title: `Welcome, ${name}!`,
              text: "Login berhasil.",
              timer: 1500,
              showConfirmButton: false,
            }).then(() => {
              if (role === "Admin") {
                window.location.href = "admin_home.html";
              } else {
                window.location.href = "index.html";
              }
            });
          } else {
            Swal.fire(
              "Login Gagal",
              result.message || "Email/Password salah",
              "error"
            );
          }
        } catch (error) {
          console.error(error);
          Swal.fire("Error", "Server tidak merespon", "error");
        }
      }

      //2. REGISTER
      async function handleRegister(event) {
        event.preventDefault();

        const registerData = {
          namaLengkap: document.getElementById("regName").value,
          nomorHp: document.getElementById("regPhone").value,
          email: document.getElementById("regEmail").value,
          password: document.getElementById("regPassword").value,
          role: "User",
        };
        try {
          const response = await fetch(`${API_URL}/register`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(registerData),
          });

          const result = await response.json();

          if (response.ok) {
            Swal.fire({
              icon: "success",
              title: "Akun Berhasil Dibuat!",
              text: "Silakan login dengan akun baru Anda.",
              confirmButtonColor: "#198754",
            }).then(() => {
              event.target.reset();

              const loginTab = new bootstrap.Tab(
                document.querySelector("#login-tab")
              );
              loginTab.show();
            });
          } else {
            Swal.fire(
              "Gagal Daftar",
              result.message || "Email mungkin sudah dipakai",
              "error"
            );
          }
        } catch (error) {
          console.error(error);
          Swal.fire("Error", "Gagal menghubungi server", "error");
        }
      }
    </script>
  </body>
</html>
